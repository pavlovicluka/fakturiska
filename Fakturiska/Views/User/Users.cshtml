@model IEnumerable<Fakturiska.Models.UserModel>

@{
    ViewBag.Title = "Users";
}

<h2>Users</h2>

<div id="popover-head" class="hide">
    some title
</div>

<div id="popover-content" class="hide">
    <div id="createUserForm">
        Role:<br>
        <select id="roleSelect">
            <option value="1">Admin</option>
            <option value="2">User</option>
        </select>
        <br>
        Email:<br>
        <input id="userEmail" type="email">
        <br><br>
        <button id="createUser">Submit</button>
    </div>
</div> 

<a href="#" id="addUser" title="Add User" class="btn btn-default" data-toggle="popover">Add User</a><br>

<table id="tableUsers" class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Email)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.RoleName)
            </th>
            <th></th>
        </tr>
    </thead>

    <tbody>
        @foreach (var item in Model) {
            <tr>
                <td>
                    <a href="#" id="userEmail" class="editEmail" data-type="text" data-pk="@item.UserGuid" data-url="EditUser" data-title="Edit email">@item.Email</a> 
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.RoleName)
                </td>
                <td>
                    @Html.ActionLink("Obrisi", "DeleteUser", new {  id=item.UserGuid  })
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
<link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet" />

<script type="text/javascript">
    $(document).ready(function () {
        $('#tableUsers').DataTable({
            "columnDefs": [{
                "targets": 2,
                "searchable": false,
                "orderable": false,
            }]
        });

        $('.editEmail').editable();
        var popover = $('#addUser').popover({
            html: true,
            title: function () {
                return $("#popover-head").html();
            },
            content: function () {
                return $("#popover-content").html();
            }
        });

        $(document).on('click', '#createUser', function () {
            console.log($('.popover-content').find('#roleSelect').val());
            console.log($('.popover-content').find('#userEmail').val());

            $.post("CreateUserWithoutPassword", { email: $('.popover-content').find('#userEmail').val(), role: $('.popover-content').find('#roleSelect').val() }, function (result) {
                $('.popover-content').find('#roleSelect').val("1");
                $('.popover-content').find('#userEmail').val("");
                $('#addUser').popover('hide');
            });
        });
    });
</script>
}






